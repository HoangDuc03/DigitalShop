<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Product</title>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- bootstrap css -->
    <link rel="stylesheet" th:href="@{'/css/bootstrap.min.css'}">
    <!-- style css -->
    <link rel="stylesheet" th:href="@{'/css/style.css'}">
    <!-- Responsive -->
    <link rel="stylesheet" th:href="@{'/css/responsive.css'}">
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" th:href="@{'/css/jquery.mCustomScrollbar.min.css'}">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
    <style>
        .navigation.navbar-dark .navbar-nav .nav-link {
            padding: 8px 20px;
        }
    </style>
</head>
<body>
<div th:include="header"></div>
<div class="temp">
    <div class="contemp">

        <h1 class="text-center" style="font-size: xx-large; margin-bottom: 0px"><b>Our Products</b></h1>
        <p class="text-center" style="margin-bottom: 30px">Some products are available in our store.</p>
        <div class="row justify-content-center">
            <div class="col-auto">
                <form th:action="@{/Product}" method="get" class="form-inline">
                    <div class="form-group mx-2">
                        <input type="text" name="search" class="form-control" placeholder="Search by name" th:value="${search}">
                    </div>
                    <div class="form-group mx-2">
                        <select name="sort" class="form-control">
                            <option value="asc" th:selected="${sort == 'asc'}">Price Low to High</option>
                            <option value="desc" th:selected="${sort == 'desc'}">Price High to Low</option>
                        </select>
                    </div>
                    <div class="form-group mx-2">
                        <select name="priceRange" class="form-control">
                            <option value="" th:selected="${priceRange == ''}">Select Price Range</option>
                            <option value="0-50000" th:selected="${priceRange == '0-50000'}"> < 50.000</option>
                            <option value="50000-100000" th:selected="${priceRange == '50000-100000'}">50.000 - 100.000</option>
                            <option value="100000-200000" th:selected="${priceRange == '100000-200000'}">100.000 - 200.000</option>
                            <option value="200000-500000" th:selected="${priceRange == '200000-500000'}">200.000 - 500.000</option>
                            <option value="500000-" th:selected="${priceRange == '500000-'}">> 500.000</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary mx-2">Search</button>
                </form>
            </div>

            <div class="row" th:if="${#lists.isEmpty(products)}">
                <div class="col-md-12">
                    <div class="alert alert-warning" role="alert">No products found.</div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row">
                    <div th:each="product : ${products}" class="col-xl-3 col-lg-3 col-md-6 col-sm-6">
                        <div class="glasses_box" style="width: 100%">
                            <a th:href="@{/ProductDetail/detail(id=${product.ID})}">
                                <figure><img th:src="@{'/ProductImages/' + ${product.image}}" alt="Product's Image" style="width: 95%; height: 300px; border: 1px solid grey; border-radius: 20px"/>
                                    <h3><span class="price" th:text="${product.price}">50</span> VNƒê</h3>
                                    <p th:text="${product.name}"></p>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row justify-content-center" th:if="${totalPages > 1}">
            <div class="col-auto">
                <nav>
                    <ul class="pagination">
                        <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                            <a class="page-link" th:href="@{/Product(page=${currentPage - 1}, size=${size}, search=${search}, sort=${sort}, priceRange=${priceRange})}">Previous</a>
                        </li>
                        <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}" th:classappend="${currentPage == i} ? 'active'">
                            <a class="page-link" th:href="@{/Product(page=${i}, size=${size}, search=${search}, sort=${sort}, priceRange=${priceRange})}" th:text="${i + 1}">1</a>
                        </li>
                        <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                            <a class="page-link" th:href="@{/Product(page=${currentPage + 1}, size=${size}, search=${search}, sort=${sort}, priceRange=${priceRange})}">Next</a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>
<div th:include="footer"></div>
</body>
<script>
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.has('errorWarehouseQuantity')) {
            alert('Product is not available at the moment! Please choose another one!');
        }
    };
</script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Function to format number with thousand separators
        function formatPrice(price) {
            return price.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        // Select all elements with class 'price'
        document.querySelectorAll('.price').forEach(function(element) {
            // Get the text content of the element
            let price = element.textContent;
            // Format the price and set it back to the element
            element.textContent = formatPrice(price);
        });
    });
</script>
</html>
